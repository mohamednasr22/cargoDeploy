(function(){function t(t){function n(n,e,r,i,o,u){for(;o>=0&&u>o;o+=t){var a=i?i[o]:o;r=e(r,n[a],a,n)}return r}return function(e,r,i,o){r=m(r,o,4);var u=!M(e)&&g.keys(e),a=(u||e).length,s=t>0?0:a-1;return arguments.length<3&&(i=e[u?u[s]:s],s+=t),n(e,r,i,u,s,a)}}function n(t){return function(n,e,r){e=x(e,r);for(var i=P(n),o=t>0?0:i-1;o>=0&&i>o;o+=t)if(e(n[o],o,n))return o;return-1}}function e(t,n,e){return function(r,i,o){var u=0,a=P(r);if("number"==typeof o)t>0?u=o>=0?o:Math.max(o+a,u):a=o>=0?Math.min(o+1,a):o+a+1;else if(e&&o&&a)return r[o=e(r,i)]===i?o:-1;if(i!=i)return(o=n(l.call(r,u,a),g.isNaN))>=0?o+u:-1;for(o=t>0?u:a-1;o>=0&&a>o;o+=t)if(r[o]===i)return o;return-1}}function r(t,n){var e=D.length,r=t.constructor,i=g.isFunction(r)&&r.prototype||a,o="constructor";for(g.has(t,o)&&!g.contains(n,o)&&n.push(o);e--;)(o=D[e])in t&&t[o]!==i[o]&&!g.contains(n,o)&&n.push(o)}var i=this,o=i._,u=Array.prototype,a=Object.prototype,s=Function.prototype,c=u.push,l=u.slice,h=a.toString,f=a.hasOwnProperty,p=Array.isArray,v=Object.keys,d=s.bind,y=Object.create,_=function(){},g=function(t){return t instanceof g?t:this instanceof g?void(this._wrapped=t):new g(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._=g):i._=g,g.VERSION="1.8.3";var m=function(t,n,e){if(void 0===n)return t;switch(null==e?3:e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,i){return t.call(n,e,r,i)};case 4:return function(e,r,i,o){return t.call(n,e,r,i,o)}}return function(){return t.apply(n,arguments)}},x=function(t,n,e){return null==t?g.identity:g.isFunction(t)?m(t,n,e):g.isObject(t)?g.matcher(t):g.property(t)};g.iteratee=function(t,n){return x(t,n,1/0)};var w=function(t,n){return function(e){var r=arguments.length;if(2>r||null==e)return e;for(var i=1;r>i;i++)for(var o=arguments[i],u=t(o),a=u.length,s=0;a>s;s++){var c=u[s];n&&void 0!==e[c]||(e[c]=o[c])}return e}},b=function(t){if(!g.isObject(t))return{};if(y)return y(t);_.prototype=t;var n=new _;return _.prototype=null,n},E=function(t){return function(n){return null==n?void 0:n[t]}},k=Math.pow(2,53)-1,P=E("length"),M=function(t){var n=P(t);return"number"==typeof n&&n>=0&&k>=n};g.each=g.forEach=function(t,n,e){var r,i;if(n=m(n,e),M(t))for(r=0,i=t.length;i>r;r++)n(t[r],r,t);else{var o=g.keys(t);for(r=0,i=o.length;i>r;r++)n(t[o[r]],o[r],t)}return t},g.map=g.collect=function(t,n,e){n=x(n,e);for(var r=!M(t)&&g.keys(t),i=(r||t).length,o=Array(i),u=0;i>u;u++){var a=r?r[u]:u;o[u]=n(t[a],a,t)}return o},g.reduce=g.foldl=g.inject=t(1),g.reduceRight=g.foldr=t(-1),g.find=g.detect=function(t,n,e){var r;return void 0!==(r=M(t)?g.findIndex(t,n,e):g.findKey(t,n,e))&&-1!==r?t[r]:void 0},g.filter=g.select=function(t,n,e){var r=[];return n=x(n,e),g.each(t,function(t,e,i){n(t,e,i)&&r.push(t)}),r},g.reject=function(t,n,e){return g.filter(t,g.negate(x(n)),e)},g.every=g.all=function(t,n,e){n=x(n,e);for(var r=!M(t)&&g.keys(t),i=(r||t).length,o=0;i>o;o++){var u=r?r[o]:o;if(!n(t[u],u,t))return!1}return!0},g.some=g.any=function(t,n,e){n=x(n,e);for(var r=!M(t)&&g.keys(t),i=(r||t).length,o=0;i>o;o++){var u=r?r[o]:o;if(n(t[u],u,t))return!0}return!1},g.contains=g.includes=g.include=function(t,n,e,r){return M(t)||(t=g.values(t)),("number"!=typeof e||r)&&(e=0),g.indexOf(t,n,e)>=0},g.invoke=function(t,n){var e=l.call(arguments,2),r=g.isFunction(n);return g.map(t,function(t){var i=r?n:t[n];return null==i?i:i.apply(t,e)})},g.pluck=function(t,n){return g.map(t,g.property(n))},g.where=function(t,n){return g.filter(t,g.matcher(n))},g.findWhere=function(t,n){return g.find(t,g.matcher(n))},g.max=function(t,n,e){var r,i,o=-1/0,u=-1/0;if(null==n&&null!=t)for(var a=0,s=(t=M(t)?t:g.values(t)).length;s>a;a++)(r=t[a])>o&&(o=r);else n=x(n,e),g.each(t,function(t,e,r){((i=n(t,e,r))>u||i===-1/0&&o===-1/0)&&(o=t,u=i)});return o},g.min=function(t,n,e){var r,i,o=1/0,u=1/0;if(null==n&&null!=t)for(var a=0,s=(t=M(t)?t:g.values(t)).length;s>a;a++)o>(r=t[a])&&(o=r);else n=x(n,e),g.each(t,function(t,e,r){i=n(t,e,r),(u>i||1/0===i&&1/0===o)&&(o=t,u=i)});return o},g.shuffle=function(t){for(var n,e=M(t)?t:g.values(t),r=e.length,i=Array(r),o=0;r>o;o++)(n=g.random(0,o))!==o&&(i[o]=i[n]),i[n]=e[o];return i},g.sample=function(t,n,e){return null==n||e?(M(t)||(t=g.values(t)),t[g.random(t.length-1)]):g.shuffle(t).slice(0,Math.max(0,n))},g.sortBy=function(t,n,e){return n=x(n,e),g.pluck(g.map(t,function(t,e,r){return{value:t,index:e,criteria:n(t,e,r)}}).sort(function(t,n){var e=t.criteria,r=n.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return t.index-n.index}),"value")};var j=function(t){return function(n,e,r){var i={};return e=x(e,r),g.each(n,function(r,o){var u=e(r,o,n);t(i,r,u)}),i}};g.groupBy=j(function(t,n,e){g.has(t,e)?t[e].push(n):t[e]=[n]}),g.indexBy=j(function(t,n,e){t[e]=n}),g.countBy=j(function(t,n,e){g.has(t,e)?t[e]++:t[e]=1}),g.toArray=function(t){return t?g.isArray(t)?l.call(t):M(t)?g.map(t,g.identity):g.values(t):[]},g.size=function(t){return null==t?0:M(t)?t.length:g.keys(t).length},g.partition=function(t,n,e){n=x(n,e);var r=[],i=[];return g.each(t,function(t,e,o){(n(t,e,o)?r:i).push(t)}),[r,i]},g.first=g.head=g.take=function(t,n,e){return null==t?void 0:null==n||e?t[0]:g.initial(t,t.length-n)},g.initial=function(t,n,e){return l.call(t,0,Math.max(0,t.length-(null==n||e?1:n)))},g.last=function(t,n,e){return null==t?void 0:null==n||e?t[t.length-1]:g.rest(t,Math.max(0,t.length-n))},g.rest=g.tail=g.drop=function(t,n,e){return l.call(t,null==n||e?1:n)},g.compact=function(t){return g.filter(t,g.identity)};var T=function(t,n,e,r){for(var i=[],o=0,u=r||0,a=P(t);a>u;u++){var s=t[u];if(M(s)&&(g.isArray(s)||g.isArguments(s))){n||(s=T(s,n,e));var c=0,l=s.length;for(i.length+=l;l>c;)i[o++]=s[c++]}else e||(i[o++]=s)}return i};g.flatten=function(t,n){return T(t,n,!1)},g.without=function(t){return g.difference(t,l.call(arguments,1))},g.uniq=g.unique=function(t,n,e,r){g.isBoolean(n)||(r=e,e=n,n=!1),null!=e&&(e=x(e,r));for(var i=[],o=[],u=0,a=P(t);a>u;u++){var s=t[u],c=e?e(s,u,t):s;n?(u&&o===c||i.push(s),o=c):e?g.contains(o,c)||(o.push(c),i.push(s)):g.contains(i,s)||i.push(s)}return i},g.union=function(){return g.uniq(T(arguments,!0,!0))},g.intersection=function(t){for(var n=[],e=arguments.length,r=0,i=P(t);i>r;r++){var o=t[r];if(!g.contains(n,o)){for(var u=1;e>u&&g.contains(arguments[u],o);u++);u===e&&n.push(o)}}return n},g.difference=function(t){var n=T(arguments,!0,!0,1);return g.filter(t,function(t){return!g.contains(n,t)})},g.zip=function(){return g.unzip(arguments)},g.unzip=function(t){for(var n=t&&g.max(t,P).length||0,e=Array(n),r=0;n>r;r++)e[r]=g.pluck(t,r);return e},g.object=function(t,n){for(var e={},r=0,i=P(t);i>r;r++)n?e[t[r]]=n[r]:e[t[r][0]]=t[r][1];return e},g.findIndex=n(1),g.findLastIndex=n(-1),g.sortedIndex=function(t,n,e,r){for(var i=(e=x(e,r,1))(n),o=0,u=P(t);u>o;){var a=Math.floor((o+u)/2);e(t[a])<i?o=a+1:u=a}return o},g.indexOf=e(1,g.findIndex,g.sortedIndex),g.lastIndexOf=e(-1,g.findLastIndex),g.range=function(t,n,e){null==n&&(n=t||0,t=0),e=e||1;for(var r=Math.max(Math.ceil((n-t)/e),0),i=Array(r),o=0;r>o;o++,t+=e)i[o]=t;return i};var A=function(t,n,e,r,i){if(!(r instanceof n))return t.apply(e,i);var o=b(t.prototype),u=t.apply(o,i);return g.isObject(u)?u:o};g.bind=function(t,n){if(d&&t.bind===d)return d.apply(t,l.call(arguments,1));if(!g.isFunction(t))throw new TypeError("Bind must be called on a function");var e=l.call(arguments,2),r=function(){return A(t,r,n,this,e.concat(l.call(arguments)))};return r},g.partial=function(t){var n=l.call(arguments,1),e=function(){for(var r=0,i=n.length,o=Array(i),u=0;i>u;u++)o[u]=n[u]===g?arguments[r++]:n[u];for(;r<arguments.length;)o.push(arguments[r++]);return A(t,e,this,this,o)};return e},g.bindAll=function(t){var n,e,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(n=1;r>n;n++)t[e=arguments[n]]=g.bind(t[e],t);return t},g.memoize=function(t,n){var e=function(r){var i=e.cache,o=""+(n?n.apply(this,arguments):r);return g.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return e.cache={},e},g.delay=function(t,n){var e=l.call(arguments,2);return setTimeout(function(){return t.apply(null,e)},n)},g.defer=g.partial(g.delay,g,1),g.throttle=function(t,n,e){var r,i,o,u=null,a=0;e||(e={});var s=function(){a=!1===e.leading?0:g.now(),u=null,o=t.apply(r,i),u||(r=i=null)};return function(){var c=g.now();a||!1!==e.leading||(a=c);var l=n-(c-a);return r=this,i=arguments,0>=l||l>n?(u&&(clearTimeout(u),u=null),a=c,o=t.apply(r,i),u||(r=i=null)):u||!1===e.trailing||(u=setTimeout(s,l)),o}},g.debounce=function(t,n,e){var r,i,o,u,a,s=function(){var c=g.now()-u;n>c&&c>=0?r=setTimeout(s,n-c):(r=null,e||(a=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,u=g.now();var c=e&&!r;return r||(r=setTimeout(s,n)),c&&(a=t.apply(o,i),o=i=null),a}},g.wrap=function(t,n){return g.partial(n,t)},g.negate=function(t){return function(){return!t.apply(this,arguments)}},g.compose=function(){var t=arguments,n=t.length-1;return function(){for(var e=n,r=t[n].apply(this,arguments);e--;)r=t[e].call(this,r);return r}},g.after=function(t,n){return function(){return--t<1?n.apply(this,arguments):void 0}},g.before=function(t,n){var e;return function(){return--t>0&&(e=n.apply(this,arguments)),1>=t&&(n=null),e}},g.once=g.partial(g.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];g.keys=function(t){if(!g.isObject(t))return[];if(v)return v(t);var n=[];for(var e in t)g.has(t,e)&&n.push(e);return O&&r(t,n),n},g.allKeys=function(t){if(!g.isObject(t))return[];var n=[];for(var e in t)n.push(e);return O&&r(t,n),n},g.values=function(t){for(var n=g.keys(t),e=n.length,r=Array(e),i=0;e>i;i++)r[i]=t[n[i]];return r},g.mapObject=function(t,n,e){n=x(n,e);for(var r,i=g.keys(t),o=i.length,u={},a=0;o>a;a++)u[r=i[a]]=n(t[r],r,t);return u},g.pairs=function(t){for(var n=g.keys(t),e=n.length,r=Array(e),i=0;e>i;i++)r[i]=[n[i],t[n[i]]];return r},g.invert=function(t){for(var n={},e=g.keys(t),r=0,i=e.length;i>r;r++)n[t[e[r]]]=e[r];return n},g.functions=g.methods=function(t){var n=[];for(var e in t)g.isFunction(t[e])&&n.push(e);return n.sort()},g.extend=w(g.allKeys),g.extendOwn=g.assign=w(g.keys),g.findKey=function(t,n,e){n=x(n,e);for(var r,i=g.keys(t),o=0,u=i.length;u>o;o++)if(n(t[r=i[o]],r,t))return r},g.pick=function(t,n,e){var r,i,o={},u=t;if(null==u)return o;g.isFunction(n)?(i=g.allKeys(u),r=m(n,e)):(i=T(arguments,!1,!1,1),r=function(t,n,e){return n in e},u=Object(u));for(var a=0,s=i.length;s>a;a++){var c=i[a],l=u[c];r(l,c,u)&&(o[c]=l)}return o},g.omit=function(t,n,e){if(g.isFunction(n))n=g.negate(n);else{var r=g.map(T(arguments,!1,!1,1),String);n=function(t,n){return!g.contains(r,n)}}return g.pick(t,n,e)},g.defaults=w(g.allKeys,!0),g.create=function(t,n){var e=b(t);return n&&g.extendOwn(e,n),e},g.clone=function(t){return g.isObject(t)?g.isArray(t)?t.slice():g.extend({},t):t},g.tap=function(t,n){return n(t),t},g.isMatch=function(t,n){var e=g.keys(n),r=e.length;if(null==t)return!r;for(var i=Object(t),o=0;r>o;o++){var u=e[o];if(n[u]!==i[u]||!(u in i))return!1}return!0};var S=function(t,n,e,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t instanceof g&&(t=t._wrapped),n instanceof g&&(n=n._wrapped);var i=h.call(t);if(i!==h.call(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/+t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof n)return!1;var u=t.constructor,a=n.constructor;if(u!==a&&!(g.isFunction(u)&&u instanceof u&&g.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in n)return!1}r=r||[];for(var s=(e=e||[]).length;s--;)if(e[s]===t)return r[s]===n;if(e.push(t),r.push(n),o){if((s=t.length)!==n.length)return!1;for(;s--;)if(!S(t[s],n[s],e,r))return!1}else{var c,l=g.keys(t);if(s=l.length,g.keys(n).length!==s)return!1;for(;s--;)if(!g.has(n,c=l[s])||!S(t[c],n[c],e,r))return!1}return e.pop(),r.pop(),!0};g.isEqual=function(t,n){return S(t,n)},g.isEmpty=function(t){return null==t||(M(t)&&(g.isArray(t)||g.isString(t)||g.isArguments(t))?0===t.length:0===g.keys(t).length)},g.isElement=function(t){return!(!t||1!==t.nodeType)},g.isArray=p||function(t){return"[object Array]"===h.call(t)},g.isObject=function(t){var n=typeof t;return"function"===n||"object"===n&&!!t},g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){g["is"+t]=function(n){return h.call(n)==="[object "+t+"]"}}),g.isArguments(arguments)||(g.isArguments=function(t){return g.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=function(t){return"function"==typeof t||!1}),g.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},g.isNaN=function(t){return g.isNumber(t)&&t!==+t},g.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)},g.isNull=function(t){return null===t},g.isUndefined=function(t){return void 0===t},g.has=function(t,n){return null!=t&&f.call(t,n)},g.noConflict=function(){return i._=o,this},g.identity=function(t){return t},g.constant=function(t){return function(){return t}},g.noop=function(){},g.property=E,g.propertyOf=function(t){return null==t?function(){}:function(n){return t[n]}},g.matcher=g.matches=function(t){return t=g.extendOwn({},t),function(n){return g.isMatch(n,t)}},g.times=function(t,n,e){var r=Array(Math.max(0,t));n=m(n,e,1);for(var i=0;t>i;i++)r[i]=n(i);return r},g.random=function(t,n){return null==n&&(n=t,t=0),t+Math.floor(Math.random()*(n-t+1))},g.now=Date.now||function(){return(new Date).getTime()};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},F=g.invert(B),C=function(t){var n=function(n){return t[n]},e="(?:"+g.keys(t).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return function(t){return r.test(t=null==t?"":""+t)?t.replace(i,n):t}};g.escape=C(B),g.unescape=C(F),g.result=function(t,n,e){var r=null==t?void 0:t[n];return void 0===r&&(r=e),g.isFunction(r)?r.call(t):r};var W=0;g.uniqueId=function(t){var n=++W+"";return t?t+n:n},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\u2028|\u2029/g,U=function(t){return"\\"+I[t]};g.template=function(t,n,e){!n&&e&&(n=e),n=g.defaults({},n,g.templateSettings);var r=RegExp([(n.escape||L).source,(n.interpolate||L).source,(n.evaluate||L).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,function(n,e,r,u,a){return o+=t.slice(i,a).replace(R,U),i=a+n.length,e?o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":u&&(o+="';\n"+u+"\n__p+='"),n}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var u=new Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}var s=function(t){return u.call(this,t,g)};return s.source="function("+(n.variable||"obj")+"){\n"+o+"}",s},g.chain=function(t){var n=g(t);return n._chain=!0,n};var N=function(t,n){return t._chain?g(n).chain():n};g.mixin=function(t){g.each(g.functions(t),function(n){var e=g[n]=t[n];g.prototype[n]=function(){var t=[this._wrapped];return c.apply(t,arguments),N(this,e.apply(g,t))}})},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=u[t];g.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],N(this,e)}}),g.each(["concat","join","slice"],function(t){var n=u[t];g.prototype[t]=function(){return N(this,n.apply(this._wrapped,arguments))}}),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return g})}).call(this);var SignaturePad=function(t){"use strict";console.log.bind(console);var n=function(t,n){var e=this,r=n||{};this.velocityFilterWeight=r.velocityFilterWeight||.7,this.minWidth=r.minWidth||.5,this.maxWidth=r.maxWidth||2.5,this.dotSize=r.dotSize||function(){return(e.minWidth+e.maxWidth)/2},this.penColor=r.penColor||"black",this.backgroundColor=r.backgroundColor||"rgba(0,0,0,0)",this.throttle=r.throttle||0,this.throttleOptions={leading:!0,trailing:!0},this.minPointDistance=r.minPointDistance||0,this.onEnd=r.onEnd,this.onBegin=r.onBegin,this._canvas=t,this._ctx=t.getContext("2d"),this._ctx.canvas.width=this._canvas.getBoundingClientRect().width,this._ctx.canvas.height=this._canvas.getBoundingClientRect().height,this._ctx.lineCap="round",this.clear(),this._handleMouseDown=function(t){1===t.which&&(e._mouseButtonDown=!0,e._strokeBegin(t))},this._handleMouseMove=_.throttle(function(t){if(t.preventDefault(),e._mouseButtonDown&&(e._strokeUpdate(t),e.arePointsDisplayed)){var n=e._createPoint(t);e._drawMark(n.x,n.y,5)}},e.throttle,e.throttleOptions),this._handleMouseUp=function(t){1===t.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(t))},this._handleTouchStart=function(t){1==t.targetTouches.length&&e._strokeBegin(t.changedTouches[0])},this._handleTouchMove=_.throttle(function(t){t.preventDefault();var n=t.targetTouches[0];if(e._strokeUpdate(n),e.arePointsDisplayed){var r=e._createPoint(n);e._drawMark(r.x,r.y,5)}},e.throttle,e.throttleOptions),this._handleTouchEnd=function(t){t.target===e._canvas&&(t.preventDefault(),e._strokeEnd(t))},this._handleMouseEvents(),this._handleTouchEvents()};n.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,n.width,n.height),t.fillRect(0,0,n.width,n.height),this._reset()},n.prototype.showPointsToggle=function(){this.arePointsDisplayed=!this.arePointsDisplayed},n.prototype.toDataURL=function(t,n){var e=this._canvas;return e.toDataURL.apply(e,arguments)},n.prototype.fromDataURL=function(t){var n=this,e=new Image,r=window.devicePixelRatio||1,i=this._canvas.width/r,o=this._canvas.height/r;this._reset(),e.src=t,e.onload=function(){n._ctx.drawImage(e,0,0,i,o)},this._isEmpty=!1},n.prototype._strokeUpdate=function(t){var n=this._createPoint(t);this._isPointToBeUsed(n)&&this._addPoint(n)},n.prototype._isPointToBeUsed=function(t){if(!this.minPointDistance)return!0;var n=this.points;return!(n&&n.length&&t.distanceTo(n[n.length-1])<this.minPointDistance)},n.prototype._strokeBegin=function(t){this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},n.prototype._strokeDraw=function(t){var n=this._ctx,e="function"==typeof this.dotSize?this.dotSize():this.dotSize;n.beginPath(),this._drawPoint(t.x,t.y,e),n.closePath(),n.fill()},n.prototype._strokeEnd=function(t){var n=this.points[0];!(this.points.length>2)&&n&&this._strokeDraw(n),"function"==typeof this.onEnd&&this.onEnd(t)},n.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),t.addEventListener("mouseup",this._handleMouseUp)},n.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},n.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},n.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),t.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},n.prototype.isEmpty=function(){return this._isEmpty},n.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},n.prototype._createPoint=function(t){var n=this._canvas.getBoundingClientRect();return new e(t.clientX-n.left,t.clientY-n.top)},n.prototype._addPoint=function(t){var n,e,i,o=this.points;o.push(t),o.length>2&&(3===o.length&&o.unshift(o[0]),n=this._calculateCurveControlPoints(o[0],o[1],o[2]).c2,i=this._calculateCurveControlPoints(o[1],o[2],o[3]),e=new r(o[1],n,i.c1,o[2]),this._addCurve(e),o.shift())},n.prototype._calculateCurveControlPoints=function(t,n,r){var i=t.x-n.x,o=t.y-n.y,u=n.x-r.x,a=n.y-r.y,s=(t.x+n.x)/2,c=(t.y+n.y)/2,l=(n.x+r.x)/2,h=(n.y+r.y)/2,f=Math.sqrt(1*i*i+o*o),p=Math.sqrt(1*u*u+a*a),v=p/(f+p),d=n.x-(l+(s-l)*v),y=n.y-(h+(c-h)*v);return{c1:new e(s+d,c+y),c2:new e(l+d,h+y)}},n.prototype._addCurve=function(t){var n,e;n=t.endPoint.velocityFrom(t.startPoint),e=this._strokeWidth(n=this.velocityFilterWeight*n+(1-this.velocityFilterWeight)*this._lastVelocity),this._drawCurve(t,this._lastWidth,e),this._lastVelocity=n,this._lastWidth=e},n.prototype._drawPoint=function(t,n,e){var r=this._ctx;r.moveTo(t,n),r.arc(t,n,e,0,2*Math.PI,!1),this._isEmpty=!1},n.prototype._drawMark=function(t,n,e){var r=this._ctx;r.save(),r.moveTo(t,n),r.arc(t,n,e,0,2*Math.PI,!1),r.fillStyle="rgba(255, 0, 0, 0.2)",r.fill(),r.restore()},n.prototype._drawCurve=function(t,n,e){var r,i,o,u,a,s,c,l,h,f,p=this._ctx,v=e-n;for(r=Math.floor(t.length()),p.beginPath(),i=0;i<r;i++)h=(l=(c=(s=1-(o=i/r))*s)*s)*t.startPoint.x,h+=3*c*o*t.control1.x,h+=3*s*(u=o*o)*t.control2.x,f=l*t.startPoint.y,f+=3*c*o*t.control1.y,f+=3*s*u*t.control2.y,this._drawPoint(h+=(a=u*o)*t.endPoint.x,f+=a*t.endPoint.y,n+a*v);p.closePath(),p.fill()},n.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};var e=function(t,n,e){this.x=t,this.y=n,this.time=e||(new Date).getTime()};e.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},e.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};var r=function(t,n,e,r){this.startPoint=t,this.control1=n,this.control2=e,this.endPoint=r};return r.prototype.length=function(){var t,n,e,r,i,o,u,a,s=0;for(t=0;t<=10;t++)e=this._point(n=t/10,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(n,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),t>0&&(u=e-i,a=r-o,s+=Math.sqrt(u*u+a*a)),i=e,o=r;return s},r.prototype._point=function(t,n,e,r,i){return n*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*r*(1-t)*t*t+i*t*t*t},n}(document);